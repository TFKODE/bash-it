- name: installer python3-pygments
  apt:
    name:
      python3-pygments
    state: present
    update_cache: yes

- name: cloner bash-it*
  git:
    repo: https://github.com/Bash-it/bash-it.git
    dest: /root/.bash_it
    depth: 1 
    update: no

- name : installer bash-it silencieusement
  shell: /root/.bash_it/install.sh --silent
  args:
    creates: /root/.bash_it

- name: Charger bash-it autotmatiquement dans le terminal 
  lineinfile:
    path: /root/.bashrc
    insertafter: '^export BASH_IT_THEME="bobby"$'
    line: 'source ~/.bash_it/bash_it.sh'
    create: yes 

- name: Ajouter un alias pour pycolor pour une coloration Python 
  lineinfile:
    path: /root/.bashrc
    line: 'alias pycolor="pygmentize -g"'
    create: yes


- name: Ajouter fonction logview et alias logs colorés dans .bashrc
  blockinfile:
    path: /root/.bashrc
    marker: "# {mark} ANSIBLE LOGVIEW FUNCTION"
    block: |
      # Fonction pour afficher les logs systemd avec couleurs et icônes
      function logview() {
        local service_name="$1"
        if [[ -z "$service_name" ]]; then
          echo "Usage: logview <nom_du_service>"
          return 1
        fi

        journalctl -u "$service_name".service -f -o cat | awk '
        BEGIN {
          RED = "\033[1;31m"
          GREEN = "\033[1;32m"
          YELLOW = "\033[1;33m"
          BLUE = "\033[1;34m"
          MAGENTA = "\033[1;35m"
          CYAN = "\033[1;36m"
          WHITE = "\033[1;37m"
          GRAY = "\033[0;37m"
          RESET = "\033[0m"
          SEP = "\n──────────────────────────────────────────────\n"
        }
        {
          if ($0 ~ /level=info/) {
            printf "%s%s🛈 INFO:%s %s\n", SEP, GREEN, RESET, $0
          } else if ($0 ~ /level=debug/) {
            printf "%s%s🐛 DEBUG:%s %s\n", SEP, CYAN, RESET, $0
          } else if ($0 ~ /level=warn/ || $0 ~ /WARN/) {
            printf "%s%s⚠️  WARNING:%s %s\n", SEP, YELLOW, RESET, $0
          } else if ($0 ~ /level=error/ || $0 ~ /ERROR/) {
            printf "%s%s❌ ERROR:%s %s\n", SEP, RED, RESET, $0
          } else if ($0 ~ /push cert topic=/) {
            printf "%s%s📨 Push Cert Stored:%s %s\n", SEP, MAGENTA, RESET, $0
          } else if ($0 ~ /checkin/) {
            printf "%s%s🔁 Check-in:%s %s\n", SEP, BLUE, RESET, $0
          } else if ($0 ~ /TokenUpdate/) {
            printf "%s%s🔐 TokenUpdate:%s %s\n", SEP, BLUE, RESET, $0
          } else if ($0 ~ /InstallProfile/) {
            printf "%s%s📦 InstallProfile:%s %s\n", SEP, GREEN, RESET, $0
          } else if ($0 ~ /status=Acknowledged/) {
            printf "%s%s✅ Acknowledged:%s %s\n", SEP, CYAN, RESET, $0
          } else {
            print $0
          }
        }
        '
      }

      # Alias pratiques pour appeler logview sur des services courants
      alias nanolog='logview nano'
      alias sshlog='logview ssh'
      alias mysqlog='logview mysql'